<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>锐蓝3D打印wiki</title>
    <description></description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 02 Mar 2018 16:29:19 +0800</pubDate>
    <lastBuildDate>Fri, 02 Mar 2018 16:29:19 +0800</lastBuildDate>
    <generator>Jekyll v3.3.1</generator>
    
      <item>
        <title>rayland-SLA主板使用说明</title>
        <description>&lt;ul&gt;
  &lt;li&gt;content
[[{:toc}]]&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;RAYLAND-SLA是乐轩锐蓝推出的集振镜控制和电机控制于一体的控制板。性能可以对标ScanLab的同类型板卡。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/1B9E6A5E-FA15-4CD4-9C86-285A7B57FAF6.png&quot; alt=&quot;1B9E6A5E-FA15-4CD4-9C86-285A7B57FAF6&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;基本参数&quot;&gt;基本参数&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;尺寸&lt;/th&gt;
      &lt;th&gt;115×93 mm&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;重量&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;工作温度&lt;/td&gt;
      &lt;td&gt;-20～65℃&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器主频&lt;/td&gt;
      &lt;td&gt;1.4GHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器类型&lt;/td&gt;
      &lt;td&gt;4核 Cortex A7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;协处理器&lt;/td&gt;
      &lt;td&gt;72MHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;内存容量&lt;/td&gt;
      &lt;td&gt;1Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Flash&lt;/td&gt;
      &lt;td&gt;4Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;最大外接Flash&lt;/td&gt;
      &lt;td&gt;32Gbytes&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

</description>
        <pubDate>Thu, 18 Jan 2018 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/18/rayland-SLA_USERMANUAL/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/18/rayland-SLA_USERMANUAL/</guid>
        
        <category>3D打印</category>
        
        
        <category>FDM</category>
        
      </item>
    
      <item>
        <title>rayland-dual主板控制舵机</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#舵机基本参数&quot; id=&quot;markdown-toc-舵机基本参数&quot;&gt;舵机基本参数&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#基本参数&quot; id=&quot;markdown-toc-基本参数&quot;&gt;基本参数&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文介绍了如何使用RAYLAND-DUAL主板的电机输出接口来控制舵机&lt;/p&gt;

&lt;h2 id=&quot;舵机基本参数&quot;&gt;舵机基本参数&lt;/h2&gt;

&lt;p&gt;RAYLAND-DUAL可以用来控制舵机，目前暂时只支持脉冲宽度调制的舵机。脉冲宽度调制的舵机能接受1ms&amp;lt;2ms脉宽的。其中1ms和2ms分别对应最左和最右位置，1.5ms对应中间位置。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/F384E714-1E01-4CA5-832F-39D6FA36AAA2.png&quot; alt=&quot;F384E714-1E01-4CA5-832F-39D6FA36AAA2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这是一款典型舵机的工作参数&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/DB3D289D-2ABF-4844-9981-C469354DF5E4.png&quot; alt=&quot;DB3D289D-2ABF-4844-9981-C469354DF5E4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;综合上面两个图，舵机的控制典型值有下面三个&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;名称&lt;/th&gt;
      &lt;th&gt;典型值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;脉冲宽度范围&lt;/td&gt;
      &lt;td&gt;1ms～2ms&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;脉冲周期&lt;/td&gt;
      &lt;td&gt;20ms&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;电压&lt;/td&gt;
      &lt;td&gt;4.8v～6V&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;死区&lt;/td&gt;
      &lt;td&gt;5us&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;脉冲宽度范围处以死去就是舵机的角度分辨率
&lt;script type=&quot;math/tex&quot;&gt;LSB = \frac{\Delta_{width}}{T}=1ms/5us = 200&lt;/script&gt;
所以控制一个舵机的需要一个byte的数据量。&lt;/p&gt;

&lt;h2 id=&quot;基本参数&quot;&gt;基本参数&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;尺寸&lt;/th&gt;
      &lt;th&gt;115×93 mm&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;重量&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;工作温度&lt;/td&gt;
      &lt;td&gt;-20～65℃&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器主频&lt;/td&gt;
      &lt;td&gt;1.4GHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器类型&lt;/td&gt;
      &lt;td&gt;4核 Cortex A7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;协处理器&lt;/td&gt;
      &lt;td&gt;72MHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;内存容量&lt;/td&gt;
      &lt;td&gt;1Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Flash&lt;/td&gt;
      &lt;td&gt;4Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;最大外接Flash&lt;/td&gt;
      &lt;td&gt;32Gbytes&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

</description>
        <pubDate>Tue, 16 Jan 2018 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/16/rayland-dual_AN_SWEEPER/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/16/rayland-dual_AN_SWEEPER/</guid>
        
        <category>3D打印</category>
        
        
        <category>FDM</category>
        
      </item>
    
      <item>
        <title>rayland-solo主板使用说明</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#基本参数&quot; id=&quot;markdown-toc-基本参数&quot;&gt;基本参数&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;RAYLAND-SOLO是在RAYLAND-DUAL基础上的精简型嵌入式电控主板，能同时支持四路异构电机。主板具有高精度、易开发、通用性强等特点，能够灵活快捷地集成到如3D打印机、机器人等智能设备中，为各类垂直行业应用提供高效的解决方案。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/0C8EB7CF-6FD9-466D-9D5F-9A248F1B4D00.png&quot; alt=&quot;0C8EB7CF-6FD9-466D-9D5F-9A248F1B4D00&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;基本参数&quot;&gt;基本参数&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;尺寸&lt;/th&gt;
      &lt;th&gt;115×93 mm&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;重量&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;工作温度&lt;/td&gt;
      &lt;td&gt;-20～65℃&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器主频&lt;/td&gt;
      &lt;td&gt;1.4GHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器类型&lt;/td&gt;
      &lt;td&gt;4核 Cortex A7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;协处理器&lt;/td&gt;
      &lt;td&gt;72MHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;内存容量&lt;/td&gt;
      &lt;td&gt;1Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Flash&lt;/td&gt;
      &lt;td&gt;4Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;最大外接Flash&lt;/td&gt;
      &lt;td&gt;32Gbytes&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

</description>
        <pubDate>Wed, 10 Jan 2018 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/10/rayland-solo%E4%B8%BB%E6%9D%BF%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/10/rayland-solo%E4%B8%BB%E6%9D%BF%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/</guid>
        
        <category>3D打印</category>
        
        
        <category>FDM</category>
        
      </item>
    
      <item>
        <title>rayland-dual主板使用说明</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#基本参数&quot; id=&quot;markdown-toc-基本参数&quot;&gt;基本参数&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#常见问题&quot; id=&quot;markdown-toc-常见问题&quot;&gt;常见问题&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;RAYLAND-DUAL是乐轩锐蓝推出的国内首款基于Android的嵌入式电控主板，集核心板和控制板于一体，可同时连接5个异构电机接口、6个风扇/加热棒、6个碰撞开关，并提供WiFi和SD卡扩展存储能力。主板具有高精度、易开发、通用性强等特点，能够灵活快捷地集成到如3D打印机、机器人等智能设备中，为各类垂直行业应用提供高效的解决方案。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/3C198664-D907-4C72-93F4-150CBF516EBA.png&quot; alt=&quot;3C198664-D907-4C72-93F4-150CBF516EBA&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;基本参数&quot;&gt;基本参数&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;尺寸&lt;/th&gt;
      &lt;th&gt;115×93 mm&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;重量&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;工作温度&lt;/td&gt;
      &lt;td&gt;-20～65℃&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器主频&lt;/td&gt;
      &lt;td&gt;1.4GHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主处理器类型&lt;/td&gt;
      &lt;td&gt;4核 Cortex A7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;协处理器&lt;/td&gt;
      &lt;td&gt;72MHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;内存容量&lt;/td&gt;
      &lt;td&gt;1Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Flash&lt;/td&gt;
      &lt;td&gt;4Gbytes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;最大外接Flash&lt;/td&gt;
      &lt;td&gt;32Gbytes&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;常见问题&quot;&gt;常见问题&lt;/h2&gt;

&lt;p&gt;1，使用外置驱动器的时候，发出控制指令电机不运动&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/8CDD926B-1CFF-4B8D-8B2C-EC1165CB20AF.png&quot; alt=&quot;EA63895F-790E-4B66-8B4E-6236C3CBD661&quot; /&gt;&lt;/p&gt;

&lt;p&gt;参见上面的图，外置驱动器的脉冲建立时间一般是100us这个量级的，4988需要的脉冲宽度一般是1us这个量级。我们可以在系统里设置这个宽度为100us。设置页面如下。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/4FCA863C-C853-4E19-B60F-63380E6321B1.png&quot; alt=&quot;4FCA863C-C853-4E19-B60F-63380E6321B1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;设置后的效果如下，下图中蓝色的部分就是一个脉冲，他的宽度刚好为100us。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/62E1E999-0CB2-4E38-9693-5D5D51F46DB4.png&quot; alt=&quot;62E1E999-0CB2-4E38-9693-5D5D51F46DB4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;2，使用外置驱动器的时候，打印向一个方向偏，例如下图&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/CB759281-BE2E-4278-812C-FA434E662B72.png&quot; alt=&quot;CB759281-BE2E-4278-812C-FA434E662B72&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我们需要更改脉冲建立时间设置。&lt;/p&gt;

&lt;p&gt;在APP的设置页面里面可以看到这个参数，下图中红圈的部分，将它修改到50us。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2FD88660-7988-421B-84C0-30E587D3E19D.png&quot; alt=&quot;2FD88660-7988-421B-84C0-30E587D3E19D&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在这个页面里，可以看到黄色部分是脉冲方向切换的波形，蓝色部分是脉冲波形，红圈所示的时间差就是脉冲建立时间。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/63262B8C-C1EF-485F-8C2B-0780B1B2F993.png&quot; alt=&quot;63262B8C-C1EF-485F-8C2B-0780B1B2F993&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Wed, 10 Jan 2018 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/10/rayland-dual_USERMANUAL/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/10/rayland-dual_USERMANUAL/</guid>
        
        <category>3D打印</category>
        
        
        <category>FDM</category>
        
      </item>
    
      <item>
        <title>rayland-DLP主板使用说明</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#软件系统&quot; id=&quot;markdown-toc-软件系统&quot;&gt;软件系统&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#源码和镜像下载&quot; id=&quot;markdown-toc-源码和镜像下载&quot;&gt;源码和镜像下载&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#电路连接&quot; id=&quot;markdown-toc-电路连接&quot;&gt;电路连接&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#烧录镜像&quot; id=&quot;markdown-toc-烧录镜像&quot;&gt;烧录镜像&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#在rayland-dlp上安装镜像&quot; id=&quot;markdown-toc-在rayland-dlp上安装镜像&quot;&gt;在Rayland-DLP上安装镜像&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#用win32diskimager烧录镜像&quot; id=&quot;markdown-toc-用win32diskimager烧录镜像&quot;&gt;用win32DiskImager烧录镜像&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#烧录自检镜像&quot; id=&quot;markdown-toc-烧录自检镜像&quot;&gt;烧录自检镜像&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#烧录打印镜像&quot; id=&quot;markdown-toc-烧录打印镜像&quot;&gt;烧录打印镜像&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#在rayland-solodualpro上安装apk&quot; id=&quot;markdown-toc-在rayland-solodualpro上安装apk&quot;&gt;在Rayland-solo/dual/pro上安装APK&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#在app中调整曝光屏分辨率&quot; id=&quot;markdown-toc-在app中调整曝光屏分辨率&quot;&gt;在APP中调整曝光屏分辨率&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#故障排除&quot; id=&quot;markdown-toc-故障排除&quot;&gt;故障排除&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#无法获取分辨率&quot; id=&quot;markdown-toc-无法获取分辨率&quot;&gt;无法获取分辨率&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#色域不正常&quot; id=&quot;markdown-toc-色域不正常&quot;&gt;色域不正常&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#客户打印样品&quot; id=&quot;markdown-toc-客户打印样品&quot;&gt;客户打印样品&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Rayland-DLP是锐蓝科技自主研发的新产品，通过HDMI输出视频到LCD或者DLP显示端，完成树脂材料的光固化，是目前低成本高精度的打印方案。&lt;/p&gt;

&lt;p&gt;Rayland-DLP无法单独使用，需要与电机驱动板协同工作。目前支持的电机驱动板包括Rayland-dual，Rayland-solo，Rayland-pro。&lt;/p&gt;

&lt;h2 id=&quot;软件系统&quot;&gt;软件系统&lt;/h2&gt;

&lt;p&gt;Rayland-DLP是基于著名的开源操作系统Armbian开发的。工作原理很简单，从usb口接收来自电机驱动版的图像，将图像用pygame-python进行渲染之后从hdmi口进行输出。以下是我们依赖的这两个项目的链接。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.pygame.org/news&quot;&gt;pygame 主页&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.armbian.com&quot;&gt;armbian 主页&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;源码和镜像下载&quot;&gt;源码和镜像下载&lt;/h3&gt;

&lt;p&gt;基于GPL协议，我们也开放了我们的img文件和程序源码，请大家到百度网盘下载。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://pan.baidu.com/s/1c2TXdUK&quot;&gt;img和源码下载链接&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;电路连接&quot;&gt;电路连接&lt;/h2&gt;

&lt;p&gt;目前的Rayland-DLP一共有两个规格，使用方法完全一样，唯一的区别是内存大小导致的支持最大分辨率的差异。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/99F8292C-D5C8-467D-9F9A-7566435DCB46.png&quot; alt=&quot;99F8292C-D5C8-467D-9F9A-7566435DCB46&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Rayland-DLP主板上共有两个客户用接口，分别为：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;HDMI接口&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;usb接口（接dual/solo/pro板）&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;这两个接口如下图所示&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dlp_interface.jpg&quot; alt=&quot;dlp_interface&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Rayland-DLP无法单独使用，需要与电机驱动板协同工作。目前支持的电机驱动板包括Rayland-dual，Rayland-solo，Rayland-pro。在本章实例中，使用的电机驱动板为Rayland-dual。&lt;/p&gt;

&lt;p&gt;本系统由Rayland-DLP+曝光屏，Rayland-dual+控制屏，以及电机系统组成。电路链接方法如下图所示&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dlp_in_circuit.jpg&quot; alt=&quot;dlp_in_circuit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;注意&lt;/em&gt;如果通过USB口单独给Rayland-DLP供电时，请使用供电电流超过1A的电源，普通的USB2.0电源可能导致Rayland-DLP的主CPU无法启动&lt;/p&gt;

&lt;h2 id=&quot;烧录镜像&quot;&gt;烧录镜像&lt;/h2&gt;

&lt;p&gt;镜像是IMG格式的文件，在linux/macOS上用dd进行读写，在windows平台上用win32diskimager烧写&lt;/p&gt;

&lt;h3 id=&quot;在rayland-dlp上安装镜像&quot;&gt;在Rayland-DLP上安装镜像&lt;/h3&gt;
&lt;h4 id=&quot;用win32diskimager烧录镜像&quot;&gt;用win32DiskImager烧录镜像&lt;/h4&gt;

&lt;p&gt;win32diskImager是windows平台上的镜像读取和烧录软件。使用是需要指定三个选项&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;镜像文件，在Image File选项框里面&lt;/li&gt;
  &lt;li&gt;TF卡设备在Device下来菜单里面&lt;/li&gt;
  &lt;li&gt;操作动作，是read（从tf拷贝出.img）文件还是 write（将.img文件烧入TF卡）&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/images/win32disk.jpg&quot; alt=&quot;win32disk&quot; /&gt;&lt;/p&gt;

&lt;p&gt;注意自检镜像和打印镜像都使用这个工具进行烧录&lt;/p&gt;

&lt;p&gt;烧录时的进度如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/1E3EF4C2-BE6E-48DA-9899-400BBE58E3E6.png&quot; alt=&quot;1E3EF4C2-BE6E-48DA-9899-400BBE58E3E6&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;烧录自检镜像&quot;&gt;烧录自检镜像&lt;/h4&gt;

&lt;p&gt;自检镜像是用来获取曝光屏的基本参数的，基本参数包括hdmi_timing等参数。&lt;/p&gt;

&lt;p&gt;使用步骤如下：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;烧录selftest.img文件,这个tf卡以下简称亮屏卡&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/selftest_tf.png&quot; alt=&quot;selftest_tf&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;把亮屏卡插入tf卡槽&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/to_tf_slot.png&quot; alt=&quot;to_tf_slot&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;把hdmi插入hdmi口 HDMI线另一端 接屏幕&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;供电插入中间的microUSB插口、观察屏幕是否有显示。&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/cable_on.png&quot; alt=&quot;cable_on&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;屏幕出现这样字样、说明调试成功&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/FD6337D6-6052-450D-AF8C-FA4009E95941.png&quot; alt=&quot;FD6337D6-6052-450D-AF8C-FA4009E95941&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;如需定制分辨率，请将这个屏幕截取发送到客服QQ上，打了红框的这几行是关键参数，请务必拍摄清楚。&lt;/p&gt;

&lt;h4 id=&quot;烧录打印镜像&quot;&gt;烧录打印镜像&lt;/h4&gt;

&lt;p&gt;用上面的方法将print.img烧录到tf卡中，以下简称打印卡。打印镜像是用来进行DLP打印的，安装上面的电路进行链接时，在开机状态下曝光屏将出现如下的启动画面。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/A210B3C5-E56A-40C2-AA9A-7AD6A1273B20.png&quot; alt=&quot;A210B3C5-E56A-40C2-AA9A-7AD6A1273B20&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;在rayland-solodualpro上安装apk&quot;&gt;在Rayland-solo/dual/pro上安装APK&lt;/h3&gt;
&lt;p&gt;Rayland-solo/dual/pro上需要专门的APK来处理电机运动和投影图像。打印时UI屏的输入如下图所示。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dlp_on_screen.png&quot; alt=&quot;dlp_on_screen&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;在app中调整曝光屏分辨率&quot;&gt;在APP中调整曝光屏分辨率&lt;/h4&gt;

&lt;p&gt;在这个页面里可以看到曝光屏分辨率和屏幕接口种类&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/E1DF85AB-F16D-4EF4-9262-AFF589768F0F.png&quot; alt=&quot;E1DF85AB-F16D-4EF4-9262-AFF589768F0F&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这个页面是当前支持的所有分辨率种类，通过点击可以选择&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/7AB26883-A95F-48AB-9E0E-CE3ADF5EB59C.png&quot; alt=&quot;7AB26883-A95F-48AB-9E0E-CE3ADF5EB59C&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在选择了分辨率之后，系统会自动让你选择接口类型，是HDMI接口屏还是DVI接口屏。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/AF52A490-5969-4ACE-80AA-5CAED13D3FF1.png&quot; alt=&quot;AF52A490-5969-4ACE-80AA-5CAED13D3FF1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;选择曝光屏接口类型后，曝光屏系统会自动重启。&lt;/p&gt;

&lt;h3 id=&quot;故障排除&quot;&gt;故障排除&lt;/h3&gt;

&lt;h4 id=&quot;无法获取分辨率&quot;&gt;无法获取分辨率&lt;/h4&gt;

&lt;p&gt;app 里无法显示分辨率，一直显示“正在设置”&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/E9FEFAB4-4F63-4A92-BC81-6B23ECA56CA7.png&quot; alt=&quot;E9FEFAB4-4F63-4A92-BC81-6B23ECA56CA7&quot; /&gt;&lt;/p&gt;

&lt;p&gt;将烧录好的打印卡插入H3板将打印卡插入TF卡槽，然后用mircroUSB连接到电脑上。链接方法如下图所示&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/contoPC.jpeg&quot; alt=&quot;contoPC&quot; /&gt;&lt;/p&gt;

&lt;p&gt;电脑上会多出一个有线网卡，请将这个网卡的IP地址如下设置为固定值&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/IPof8152.png&quot; alt=&quot;IPof8152&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如果您使用的是Windows操作系统，那么需要安装RTL8152网卡的驱动，在不安装驱动的情况下你可以在设备管理器里面看到如下的图&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/4CE930FB-35C5-445B-A522-9BB9AB3DC293.png&quot; alt=&quot;4CE930FB-35C5-445B-A522-9BB9AB3DC293&quot; /&gt;&lt;/p&gt;

&lt;p&gt;之后用ping命令查看192.168.199.3 这一IP是否正常链接，如果不能链接则打印卡没有烧录成功，请重新烧录。&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;ping 192.168.199.3
PING 192.168.199.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;192.168.199.3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: 56 data bytes
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.633 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.409 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.486 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.480 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.482 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.481 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;6 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.516 ms
64 bytes from 192.168.199.3: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;7 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.437 ms
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当链接修复正常后应该显示如下的信息&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/ABEBC8FC-ED24-410B-9D5E-523627262EA7.png&quot; alt=&quot;ABEBC8FC-ED24-410B-9D5E-523627262EA7&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;色域不正常&quot;&gt;色域不正常&lt;/h4&gt;

&lt;p&gt;启动后色域显示不正常，整个屏幕发红，但是可以显示出打印图像。请参考“在APP中调整曝光屏分辨率”这一章节，切换屏幕接口类型。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/0B726BBC-1E25-4DE4-9A0B-8EC84F5B5CC2.png&quot; alt=&quot;0B726BBC-1E25-4DE4-9A0B-8EC84F5B5CC2&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;客户打印样品&quot;&gt;客户打印样品&lt;/h2&gt;

&lt;p&gt;艾菲尔铁塔&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/838AB13E-5CC9-42B6-B58E-90DF634E9CB1.png&quot; alt=&quot;838AB13E-5CC9-42B6-B58E-90DF634E9CB1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;戒指&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/6D4F6B36-2CB5-45FE-A514-346ED341A81E.png&quot; alt=&quot;6D4F6B36-2CB5-45FE-A514-346ED341A81E&quot; /&gt;&lt;/p&gt;

&lt;p&gt;鞋底&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/8AFE6623-5B7B-45B2-9CEC-1B897D1FDA62.png&quot; alt=&quot;8AFE6623-5B7B-45B2-9CEC-1B897D1FDA62&quot; /&gt;&lt;/p&gt;

&lt;p&gt;一堆鞋底&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/E6F78316-65D9-4CA5-AEB6-914DF7DC394A.png&quot; alt=&quot;E6F78316-65D9-4CA5-AEB6-914DF7DC394A&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Tue, 09 Jan 2018 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/09/DLP_USERMANUAL/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/09/DLP_USERMANUAL/</guid>
        
        <category>DLP</category>
        
        <category>3D打印</category>
        
        
        <category>DLP</category>
        
      </item>
    
      <item>
        <title>E5CC温控器控制手册</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#crc16&quot; id=&quot;markdown-toc-crc16&quot;&gt;CRC16&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#连续写间隔&quot; id=&quot;markdown-toc-连续写间隔&quot;&gt;连续写间隔&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#命令列表&quot; id=&quot;markdown-toc-命令列表&quot;&gt;命令列表&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#读取当前温度&quot; id=&quot;markdown-toc-读取当前温度&quot;&gt;读取当前温度&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#读取设定温度&quot; id=&quot;markdown-toc-读取设定温度&quot;&gt;读取设定温度&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文介绍了如何用Rayland-dual主板连接modbus从站来控制温控器&lt;/p&gt;

&lt;h2 id=&quot;crc16&quot;&gt;CRC16&lt;/h2&gt;

&lt;p&gt;每条命令后面都有CRC格式的计算，这里用的算法是ModBus的算法&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;crc16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFFFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x00FF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
	    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x0001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		&lt;span class=&quot;c1&quot;&gt;//for LSB == 1
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;c1&quot;&gt;//for LSB == 0
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	    &lt;span class=&quot;c1&quot;&gt;//retVal &amp;amp;= ~0x8000;
&lt;/span&gt;	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retVal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;连续写间隔&quot;&gt;连续写间隔&lt;/h2&gt;

&lt;p&gt;连续写间隔必须大于一定时间，不然写没有反应&lt;/p&gt;

&lt;h2 id=&quot;命令列表&quot;&gt;命令列表&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;../images/e5cc.png&quot; alt=&quot;e5cc&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../images/e5cc_address_tab.png&quot; alt=&quot;e5cc_address_tab&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;读取当前温度&quot;&gt;读取当前温度&lt;/h3&gt;

&lt;p&gt;当前温度的内部地址是是0x0000&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;		&lt;span class=&quot;n&quot;&gt;thisE5CCConverter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;thisE5CCConverter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmdId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x03&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;thisE5CCConverter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;thisE5CCConverter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addrL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;thisE5CCConverter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cntH&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;thisE5CCConverter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cntL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x02&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;编号&lt;/th&gt;
      &lt;th&gt;典型值&lt;/th&gt;
      &lt;th&gt;备注&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte0&lt;/td&gt;
      &lt;td&gt;0x01&lt;/td&gt;
      &lt;td&gt;从站地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte1&lt;/td&gt;
      &lt;td&gt;0x03&lt;/td&gt;
      &lt;td&gt;指令 编号&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte2&lt;/td&gt;
      &lt;td&gt;0x00&lt;/td&gt;
      &lt;td&gt;地址高8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte3&lt;/td&gt;
      &lt;td&gt;0x00&lt;/td&gt;
      &lt;td&gt;地址低8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte4&lt;/td&gt;
      &lt;td&gt;0x00&lt;/td&gt;
      &lt;td&gt;数据长度高8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte5&lt;/td&gt;
      &lt;td&gt;0x02&lt;/td&gt;
      &lt;td&gt;数据长度低8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte6&lt;/td&gt;
      &lt;td&gt;0xC4&lt;/td&gt;
      &lt;td&gt;crc16高8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte7&lt;/td&gt;
      &lt;td&gt;0x0B&lt;/td&gt;
      &lt;td&gt;crc16低8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;读取设定温度&quot;&gt;读取设定温度&lt;/h3&gt;

&lt;p&gt;设定温度的内部地址是0x0106&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;编号&lt;/th&gt;
      &lt;th&gt;典型值&lt;/th&gt;
      &lt;th&gt;备注&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte0&lt;/td&gt;
      &lt;td&gt;0x01&lt;/td&gt;
      &lt;td&gt;从站地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte1&lt;/td&gt;
      &lt;td&gt;0x03&lt;/td&gt;
      &lt;td&gt;指令 编号&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte2&lt;/td&gt;
      &lt;td&gt;0x01&lt;/td&gt;
      &lt;td&gt;地址高8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte3&lt;/td&gt;
      &lt;td&gt;0x06&lt;/td&gt;
      &lt;td&gt;地址低8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte4&lt;/td&gt;
      &lt;td&gt;0x00&lt;/td&gt;
      &lt;td&gt;数据长度高8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte5&lt;/td&gt;
      &lt;td&gt;0x02&lt;/td&gt;
      &lt;td&gt;数据长度低8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte6&lt;/td&gt;
      &lt;td&gt;0xC4&lt;/td&gt;
      &lt;td&gt;crc16高8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Byte7&lt;/td&gt;
      &lt;td&gt;0x0B&lt;/td&gt;
      &lt;td&gt;crc16低8位&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 07 Jan 2018 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/07/E5CC%E6%B8%A9%E6%8E%A7%E5%99%A8%E6%8E%A7%E5%88%B6%E6%89%8B%E5%86%8C/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/07/E5CC%E6%B8%A9%E6%8E%A7%E5%99%A8%E6%8E%A7%E5%88%B6%E6%89%8B%E5%86%8C/</guid>
        
        <category>FDM</category>
        
        <category>3D打印</category>
        
        
        <category>SLA</category>
        
      </item>
    
      <item>
        <title>用rayland-dual主板控制麦克纳姆车 控制协议</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#概述&quot; id=&quot;markdown-toc-概述&quot;&gt;概述&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#用板载安卓系统控制麦克纳姆车&quot; id=&quot;markdown-toc-用板载安卓系统控制麦克纳姆车&quot;&gt;用板载安卓系统控制麦克纳姆车&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#用ros系统控制麦克纳姆车&quot; id=&quot;markdown-toc-用ros系统控制麦克纳姆车&quot;&gt;用ROS系统控制麦克纳姆车&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#麦克纳姆车硬件接线&quot; id=&quot;markdown-toc-麦克纳姆车硬件接线&quot;&gt;麦克纳姆车硬件接线&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;本文简单介绍了用rayland-dual主板控制麦克纳姆车的接线方法和控制协议。&lt;/p&gt;

&lt;h2 id=&quot;概述&quot;&gt;概述&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/CBF15C15-F3E4-407B-939B-F6D3D3DA6776.png&quot; alt=&quot;CBF15C15-F3E4-407B-939B-F6D3D3DA6776&quot; /&gt;&lt;/p&gt;

&lt;p&gt;麦克纳姆车是一种很奇特的小车，它搭载了一种全向轮子。由于轮子构造的独特性，这种车可以做出各种奇怪的动作，比如左右平移，斜向运动。以下是这种车能进行的10个运动方向和每个轮子的转动方向之间的关系。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/F32A5FE1-6698-4134-96F0-BB5C4BAC61A1.png&quot; alt=&quot;F32A5FE1-6698-4134-96F0-BB5C4BAC61A1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;与控制AGV类似，控制马克纳姆车也有两种控制方式。一个是板载的安卓控制，另一个是用ROS系统控制，利用安卓控制的控制协议如下。&lt;/p&gt;

&lt;h2 id=&quot;用板载安卓系统控制麦克纳姆车&quot;&gt;用板载安卓系统控制麦克纳姆车&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Android -&amp;gt; Stm32&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;1.1 &lt;strong&gt;控制指令&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,is_reset,X,Y,Z,A,B,s,v&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;9bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;is_reset&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;是否抢占&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:false 1:true&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;moving_idx&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;前后&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0: 前后   1: 旋转 2:平移 3:左上和右下 4: 右上和左下&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;s&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;行驶里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;行驶速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;2.2 &lt;strong&gt;定义当前坐标&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,axis_x,axis_y,ori&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;9bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ori&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;朝向&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = 1/10°&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;-1 = -1/10°&lt;/code&gt; (逆时针为正)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;3.3 &lt;strong&gt;切换控制模式&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,controll_type&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;4bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;controll_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;控制模式&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0：板控&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;1：遥控&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Stm32 -&amp;gt; Android&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;1.1 &lt;strong&gt;状态采集&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,v_x,v_y,axis_x,axis_y,ori,rfid,magn,infra,ut_f,ut_b,moto_state,mile&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;39bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ori&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;朝向&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = 1/10°&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;-1 = -1/10°&lt;/code&gt; (逆时针为正)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;rfid&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;rfid序列号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint32&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;magn&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;磁条序列号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:missing 1:hit&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;infra&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;红外&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:false 1:true&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ut_f&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;前侧超声&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16 * &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ut_b&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;后侧超声&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16 * &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;moto_state&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;电机状态&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:stop 1:running&lt;/code&gt; 左侧第0位 右侧第一位&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;mile&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;总里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;用ros系统控制麦克纳姆车&quot;&gt;用ROS系统控制麦克纳姆车&lt;/h2&gt;

&lt;p&gt;板载的A33处理器并不能运行ROS操作系统，需要通过外接mini PC来完成。MiniPC直接和板子上的STM32进行通讯，在ros模式下，我们需要禁用板载的寻磁传感器功能，将这个口用来做miniPC和STM32的通讯。这里为了调试方便，我们暂时使用了ascii码的方式来做。&lt;/p&gt;

&lt;p&gt;MiniPC-&amp;gt;STM32&lt;/p&gt;

&lt;p&gt;命令是变长的，用字母作为命令头开始，紧接着数字，最后用\n结束，例如向前运动一整圈就是&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;X10 \n
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;格式如下&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;命令头&lt;/th&gt;
      &lt;th&gt;数字&lt;/th&gt;
      &lt;th&gt;意义&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;X&lt;/td&gt;
      &lt;td&gt;-32768～32768&lt;/td&gt;
      &lt;td&gt;前后运动&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Y&lt;/td&gt;
      &lt;td&gt;同上&lt;/td&gt;
      &lt;td&gt;左右平移&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Z&lt;/td&gt;
      &lt;td&gt;同上&lt;/td&gt;
      &lt;td&gt;原地旋转&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;A&lt;/td&gt;
      &lt;td&gt;同上&lt;/td&gt;
      &lt;td&gt;左前-右后方向&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;B&lt;/td&gt;
      &lt;td&gt;同上&lt;/td&gt;
      &lt;td&gt;右前-左后方向&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;STM32-&amp;gt;MiniPC&lt;/p&gt;

&lt;p&gt;命令是变长的，每行含有两个字母S和V，各自接一个数字，最后用\n结束。S后面的数字是当前里程，V后面的数字是当前速度。例如，当前已经以4 centRound/second的速度运行了500 centRound，则输出是&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;V4 S500 \n
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;麦克纳姆车硬件接线&quot;&gt;麦克纳姆车硬件接线&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;板上电机端口&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;麦克纳姆功能链接&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;备注&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;X电机端口&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;左前&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1FR(EN)2BK(MS1)3PG(MS2)4GND(GND)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Y电机端口&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;右前&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1FR(EN)2BK(MS1)3PG(MS2)4GND(GND)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;E0电机端口&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;左后&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1FR(EN)2BK(MS1)3PG(MS2)4GND(GND)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;E1电机端口&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;右后&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1FR(EN)2BK(MS1)3PG(MS2)4GND(GND)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;电机改成XYZE0&lt;/p&gt;

&lt;p&gt;超声接usart2&lt;/p&gt;

&lt;p&gt;寻磁接usart3&lt;/p&gt;

&lt;p&gt;sv接x_max&lt;/p&gt;

</description>
        <pubDate>Fri, 05 Jan 2018 10:00:00 +0800</pubDate>
        <link>http://localhost:4000/2018/01/05/rayland-dual_on_Mecanum/</link>
        <guid isPermaLink="true">http://localhost:4000/2018/01/05/rayland-dual_on_Mecanum/</guid>
        
        <category>AGV</category>
        
        
        <category>AGV</category>
        
      </item>
    
      <item>
        <title>用锐蓝dual主板控制AGV小车</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#agv小车接线方法&quot; id=&quot;markdown-toc-agv小车接线方法&quot;&gt;AGV小车接线方法&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#安卓系统下的agv-小车控制协议&quot; id=&quot;markdown-toc-安卓系统下的agv-小车控制协议&quot;&gt;安卓系统下的AGV 小车控制协议&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#安卓运行界面&quot; id=&quot;markdown-toc-安卓运行界面&quot;&gt;安卓运行界面&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#agv&quot; id=&quot;markdown-toc-agv&quot;&gt;AGV&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ros系统下的agv-小车控制协议&quot; id=&quot;markdown-toc-ros系统下的agv-小车控制协议&quot;&gt;ros系统下的AGV 小车控制协议&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;本文档介绍了用rayland-dual主板控制小车的控制协议。协议共分两种，1，用内置的安卓系统。2，用外置的ROS系统。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/1851AC83-793D-4179-870E-669D8F8F48C7.png&quot; alt=&quot;1851AC83-793D-4179-870E-669D8F8F48C7&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;agv小车接线方法&quot;&gt;AGV小车接线方法&lt;/h2&gt;

&lt;p&gt;上图所示AGV小车的外设默认配置&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;设备&lt;/th&gt;
      &lt;th&gt;个数&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;7寸高清触摸屏&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;超声测距&lt;/td&gt;
      &lt;td&gt;8&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;RFID&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;16通道寻磁&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;麦克风&lt;/td&gt;
      &lt;td&gt;1（可选4通道）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2w扬声器&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;UVC摄像头&lt;/td&gt;
      &lt;td&gt;1（可选扫码摄像头）&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;总体接线图&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;板上电机端口&lt;/th&gt;
      &lt;th&gt;AGV功能链接&lt;/th&gt;
      &lt;th&gt;备注&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;X电机端口&lt;/td&gt;
      &lt;td&gt;左轮驱动&lt;/td&gt;
      &lt;td&gt;1EN(EN)，2FR(MS1)，3PG(MS2)，4BK(ST)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Y电机端口&lt;/td&gt;
      &lt;td&gt;右轮驱动&lt;/td&gt;
      &lt;td&gt;1EN(EN)，2FR(MS1)，3PG(MS2)，4BK(ST)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Z电机端口&lt;/td&gt;
      &lt;td&gt;无&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;E0电机端口&lt;/td&gt;
      &lt;td&gt;左右轮SV&lt;/td&gt;
      &lt;td&gt;1GND，2 SV_左，3 SV_右，4GND 直连板接E0DIR和E0EN&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;E1电机端口&lt;/td&gt;
      &lt;td&gt;寻磁&lt;/td&gt;
      &lt;td&gt;1GND，2TX，3RX，4GND。(E1DIR和usart3_RX复用，E1STEP和usart3_tx复用)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;usart1&lt;/td&gt;
      &lt;td&gt;rfid&lt;/td&gt;
      &lt;td&gt;1GND，2TX，3RX，4GND&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;usart2&lt;/td&gt;
      &lt;td&gt;超声&lt;/td&gt;
      &lt;td&gt;1GND，2TX，3RX，4GND&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;usart3&lt;/td&gt;
      &lt;td&gt;寻磁&lt;/td&gt;
      &lt;td&gt;1GND，2TX，3RX，4GND&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;usb口&lt;/td&gt;
      &lt;td&gt;摄像头&lt;/td&gt;
      &lt;td&gt;VLC免驱摄像头&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;音频输入&lt;/td&gt;
      &lt;td&gt;单mic&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;音频输出&lt;/td&gt;
      &lt;td&gt;运放模块&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;安卓系统下的agv-小车控制协议&quot;&gt;安卓系统下的AGV 小车控制协议&lt;/h2&gt;

&lt;h3 id=&quot;安卓运行界面&quot;&gt;安卓运行界面&lt;/h3&gt;

&lt;p&gt;状态显示界面&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/F3CEE232-B2C5-4A18-B012-0EC6A13835F6.png&quot; alt=&quot;F3CEE232-B2C5-4A18-B012-0EC6A13835F6&quot; /&gt;&lt;/p&gt;

&lt;p&gt;控制界面&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/8C0CE1AB-597B-4DAD-A555-B3A73E50AFF8.png&quot; alt=&quot;8C0CE1AB-597B-4DAD-A555-B3A73E50AFF8&quot; /&gt;&lt;/p&gt;

&lt;p&gt;看听说界面&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/AAACD147-6D27-47FC-84DE-6B86AC0F1F5D.png&quot; alt=&quot;AAACD147-6D27-47FC-84DE-6B86AC0F1F5D&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;agv&quot;&gt;AGV&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Android -&amp;gt; Stm32&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;1.1 &lt;strong&gt;控制指令&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,v_x,v_y,s_x,s_y&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;12bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;is_reset&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;是否抢占&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:false 1:true&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轮速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轮速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;s_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轮里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;s_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轮里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;2.2 &lt;strong&gt;定义当前坐标&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,axis_x,axis_y,ori&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;9bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ori&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;朝向&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = 1/10°&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;-1 = -1/10°&lt;/code&gt; (逆时针为正)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;3.3 &lt;strong&gt;切换控制模式&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,controll_type&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;4bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;controll_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;控制模式&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0：板控&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;1：遥控&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;2：ROS控制&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Stm32 -&amp;gt; Android&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;1.1 &lt;strong&gt;状态采集&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,v_x,v_y,axis_x,axis_y,ori,rfid,magn,infra,ut_f,ut_b,moto_state,mile&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;39bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;controlType&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;控制类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0：板控&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;1：遥控&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;2：ROS控制&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ori&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;朝向&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = 1/10°&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;-1 = -1/10°&lt;/code&gt; (逆时针为正)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;rfid&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;rfid序列号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint32&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;magn&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;磁条序列号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:missing 1:hit&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;infra&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;红外&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:false 1:true&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ut_f&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;前侧超声&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16 * &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ut_b&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;后侧超声&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16 * &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;moto_state&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;电机状态&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:stop 1:running&lt;/code&gt; 左侧第0位 右侧第一位&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;mile&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;总里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;ros系统下的agv-小车控制协议&quot;&gt;ros系统下的AGV 小车控制协议&lt;/h2&gt;

&lt;p&gt;板载的A33处理器并不能运行ROS操作系统，需要通过外接mini PC来完成。MiniPC直接和板子上的STM32进行通讯，在ros模式下，我们需要禁用板载的寻磁传感器功能，将这个口用来做miniPC和STM32的通讯。&lt;/p&gt;

&lt;p&gt;MiniPC -&amp;gt; Stm32&lt;/p&gt;

&lt;p&gt;1.1 &lt;strong&gt;控制指令&lt;/strong&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;cmd_type,pkg_length,seq,v_x,v_y,s_x,s_y&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;prefix&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包头&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0x68&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;12bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;is_reset&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;是否抢占&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:false 1:true&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轮速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轮速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;s_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轮里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;s_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轮里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;checksum&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;校验和（不含包头包尾）&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8_t&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0~255&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;subfix&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包尾巴&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8_t&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0xff&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Stm32-&amp;gt; MiniPC&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Param&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Describe&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Type&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Range&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Unit&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;prefix&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包头&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0x68&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;cmd_type&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令类型&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;pkg_length&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包长度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;39bytes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;seq&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;指令序号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;v_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴速度&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-500 ~ 500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;(1/10)r/min&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_x&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;x轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;axis_y&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;y轴坐标&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = (1/10)r&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ori&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;朝向&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;int16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;1 = 1/10°&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;-1 = -1/10°&lt;/code&gt; (逆时针为正)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;rfid&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;rfid序列号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint32&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;magn&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;磁条序列号&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:missing 1:hit&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;infra&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;红外&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:false 1:true&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ut_f&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;前侧超声&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16 * &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ut_b&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;后侧超声&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16 * &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;moto_state&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;电机状态&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0:stop 1:running&lt;/code&gt; 左侧第0位 右侧第一位&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;mile&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;总里程&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint16&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mm&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;checksum&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;校验和（不含包头包尾）&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8_t&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0~255&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;subfix&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包尾巴&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;uint8_t&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0xff&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

</description>
        <pubDate>Mon, 30 Oct 2017 14:00:00 +0800</pubDate>
        <link>http://localhost:4000/2017/10/30/rayland-dual_on_agv/</link>
        <guid isPermaLink="true">http://localhost:4000/2017/10/30/rayland-dual_on_agv/</guid>
        
        <category>AGV</category>
        
        
        <category>AGV</category>
        
      </item>
    
      <item>
        <title>4988 vs DRV8825</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#4988-和drv8825的性能对比&quot; id=&quot;markdown-toc-4988-和drv8825的性能对比&quot;&gt;4988 和DRV8825的性能对比&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;4988-和drv8825的性能对比&quot;&gt;4988 和DRV8825的性能对比&lt;/h1&gt;
&lt;p&gt;4988 是这个样子的&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/4988.png&quot; alt=&quot;4988&quot; /&gt;&lt;/p&gt;

&lt;p&gt;DRV8825是这个样子的&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/8825.png&quot; alt=&quot;8825&quot; /&gt;&lt;/p&gt;

&lt;p&gt;DRV8729是这个样子的
&lt;img src=&quot;/images/LV8729.png&quot; alt=&quot;8729&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这两个驱动器的管脚分布和现在dual板子不兼容&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dual_socket.png&quot; alt=&quot;socket_on_dual&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如果想要将公版的4988和8825以及8729插入dual中，我们需要对参考电压vref的输出进行改变，让他恒定输出3.3V&lt;/p&gt;

&lt;p&gt;这个可以通过修改HEX来实现,下午需要做一下测试&lt;/p&gt;
</description>
        <pubDate>Sun, 29 Oct 2017 21:00:00 +0800</pubDate>
        <link>http://localhost:4000/2017/10/29/on_board_driver/</link>
        <guid isPermaLink="true">http://localhost:4000/2017/10/29/on_board_driver/</guid>
        
        <category>FDM</category>
        
        <category>3D打印</category>
        
        
        <category>FDM</category>
        
      </item>
    
      <item>
        <title>Sailfish 固件的加速度性能分析</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#stepperaccel-性能分析&quot; id=&quot;markdown-toc-stepperaccel-性能分析&quot;&gt;StepperAccel 性能分析&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#判断队列耗尽时的判断&quot; id=&quot;markdown-toc-判断队列耗尽时的判断&quot;&gt;判断队列耗尽时的判断&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#周期性判断的部分&quot; id=&quot;markdown-toc-周期性判断的部分&quot;&gt;周期性判断的部分&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;stepperaccel-性能分析&quot;&gt;StepperAccel 性能分析&lt;/h1&gt;
&lt;p&gt;StepperAccel 是 &lt;a href=&quot;https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm&quot;&gt;Bresenham 算法的一个实现&lt;/a&gt;,总的来说是&lt;/p&gt;
&lt;h2 id=&quot;判断队列耗尽时的判断&quot;&gt;判断队列耗尽时的判断&lt;/h2&gt;
&lt;p&gt;这部分代码每个Block只执行一次，就是初始化代码&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Anything in the buffer?
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plan_get_current_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;SET_IS_WORKING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;pStatus0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;setup_next_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;pStatus0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;CLR_IS_WORKING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;TIM_SetAutoreload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIM2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;c1&quot;&gt;//TIM_SetIC1Prescaler(TIM2,(SystemCoreClock/2000000)-1);
&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;TIM2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PSC&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SystemCoreClock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;stepperAxisSetHardwareEnabledToMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;axesEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这里的&lt;code class=&quot;highlighter-rouge&quot;&gt;setup_next_block()&lt;/code&gt;是设置下一个block的位置，这里每个&lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt;的结构如下&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Fields used by the bresenham algorithm for tracing the line
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STEPPER_COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// Step count along each axis
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;step_event_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// The number of step events required to complete this block
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;starting_position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STEPPER_COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;accelerate_until&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// The index of the step event on which to stop acceleration
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;decelerate_after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// The index of the step event on which to start decelerating
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;acceleration_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// The acceleration rate used for acceleration calculation
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;direction_bits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// The direction bit set for this block (refers to *_DIRECTION_BIT in config.h)
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;active_extruder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// Selects the active extruder
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;active_toolhead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// The toolhead currently active.  Note this isn't the same as active extruder
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#ifdef JKN_ADVANCE
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;use_advance_lead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int16_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;advance_lead_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int16_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;advance_lead_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;advance_pressure_relax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;//Decel phase only
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int16_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;advance_lead_prime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int16_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;advance_lead_deprime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Fields used by the motion planner to manage acceleration
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;FPTYPE&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;nominal_speed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// The nominal speed for this block in mm/min
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;FPTYPE&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;entry_speed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// Entry speed at previous-current junction in mm/min
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;FPTYPE&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;max_entry_speed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// Maximum allowable junction entry speed in mm/min
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;FPTYPE&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;millimeters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// The total travel of this block in mm
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;FPTYPE&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;acceleration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// acceleration mm/sec^2
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;recalculate_flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// Planner flag to recalculate trapezoids on entry junction
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;nominal_length_flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// Planner flag for nominal speed always reached
&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Settings for the trapezoid generator
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;nominal_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// The nominal step rate for this block in step_events/sec
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;nominal_rate_sq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// nominal_rate * nominal_rate
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;initial_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// The jerk-adjusted step rate at start of block
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;final_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// The minimal rate at exit
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;acceleration_st&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// acceleration steps/sec^2
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;use_accel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// Use acceleration when true
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;speed_changed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// Entry speed has changed
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;busy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#ifdef SIMULATOR
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;FPTYPE&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;feed_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// Original feed rate before being modified for nomimal_speed
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;planned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;				&lt;span class=&quot;c1&quot;&gt;// Count of the number of times the block was passed to caclulate_trapezoid_for_block()
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_BLOCK_BY_MOVE_INDEX
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;move_index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;dda_master_axis_index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;axesEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;isTwoWheelMotor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int32_t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;rpm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STEPPER_COUNT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;// Step count along each axis
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id=&quot;周期性判断的部分&quot;&gt;周期性判断的部分&lt;/h2&gt;
&lt;p&gt;这部分代码是在定时器时钟中断里面的，周期性执行。&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Take multiple steps per interrupt (For high speed moves)
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int8_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;step_loops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef JKN_ADVANCE
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;use_accel&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXTRUDERS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_ACCEL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;stepperAxis_dda_shift_phase16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_AXIS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;advance_lead_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_DECEL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;stepperAxis_dda_shift_phase16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_AXIS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;advance_lead_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;stepperAxis_dda_shift_phase32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_AXIS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;advance_pressure_relax_accumulator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;	    &lt;span class=&quot;c1&quot;&gt;//Step the dda for each axis
&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;move! %d/%d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_event_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;SetPIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;XST_GPIO_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;XST_PIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;_delay_us&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;asm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nop&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;asm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;nop&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;c1&quot;&gt;//stepperAxis_dda_step_mul(0x7F);
&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;ClrPIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;XST_GPIO_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;XST_PIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef OVERSAMPLED_DDA
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;oversampledCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;	    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isTwoWheelMotor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isTwoWheelMotor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_event_count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		    &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X_AXIS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Y_AXIS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;totalWheelCnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
			&lt;span class=&quot;c1&quot;&gt;//STEPPER_IOPORT_WRITE(stepperAxisPorts[i].step,false);
&lt;/span&gt;			&lt;span class=&quot;n&quot;&gt;STEPPER_IOPORT_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stepperAxisPorts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;wheelFinished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_BV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wheelFinished&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wheelFinished&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_ROBOT
&lt;/span&gt;			&lt;span class=&quot;c1&quot;&gt;//printf(&quot;i=%d steps=%d wheelfinished=%d step_events_completed =%d finished\n\r&quot;,i,step_events_completed,wheelFinished,step_events_completed);
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;		    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_event_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_ROBOT
&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;event_done = %u lround = %d rroudn = %d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;totalWheelCnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;totalWheelCnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// Calculate new timer value
&lt;/span&gt;        &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;//dummy
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;accelerate_until&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ACCELERATION PHASE
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// Note that we need to convert acceleration_time from units of
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// 2 MHz to seconds.  That is done by dividing acceleration_time
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// by 2000000.  But, that will make it 0 when we use integer
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// arithmetic.  So, we first multiply block-&amp;gt;acceleration_rate by
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// acceleration_time and then do the divide.  However, it's
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// convenient to divide by 2^24 ( &amp;gt;&amp;gt; 24 ).  So, block-&amp;gt;acceleration_rate
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// has been prescaled by a factor of 9.388608.
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//MultiU24X24toH16(acc_step_rate, acceleration_time, current_block-&amp;gt;acceleration_rate);
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//acc_step_rate = (acceleration_time* (current_block-&amp;gt;acceleration_rate)) &amp;gt;&amp;gt; 24;
&lt;/span&gt;                               
            &lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acceleration_time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acceleration_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initial_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_ST
&lt;/span&gt;	    &lt;span class=&quot;c1&quot;&gt;//printf(&quot;acc: acceleration_time = %d step_rate = %d \n\r&quot;,acceleration_time,acc_step_rate); 
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// upper limit
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nominal_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nominal_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// step_rate to timer interval
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calc_timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isTwoWheelMotor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef OVERSAMPLED_DDA
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OVERSAMPLED_DDA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;TIM_SetAutoreload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIM2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#else
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

	    &lt;span class=&quot;c1&quot;&gt;//for move
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//TIM_SetAutoreload(TIM2,temp);
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;acceleration_time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;//dummy
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decelerate_after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// DECELERATION PHASE
&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//else if (step_events_completed &amp;gt; 3663) {  // DECELERATION PHASE
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#ifdef JKN_ADVANCE
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_ACCEL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_PLATEAU&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_PLATEAU&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_DECEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;advance_pressure_relax_accumulator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;advance_pressure_relax_accumulator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;advance_pressure_relax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Note that we need to convert deceleration_time from units of
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// 2 MHz to seconds.  That is done by dividing deceleration_time
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// by 2000000.  But, that will make it 0 when we use integer
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// arithmetic.  So, we first multiply block-&amp;gt;acceleration_rate by
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// deceleration_time and then do the divide.  However, it's
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// convenient to divide by 2^24 ( &amp;gt;&amp;gt; 24 ).  So, block-&amp;gt;acceleration_rate
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// has been prescaled by a factor of 8.388608.
&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;//MultiU24X24toH16(step_rate, deceleration_time, current_block-&amp;gt;acceleration_rate);
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//step_rate = (deceleration_time * (current_block-&amp;gt;acceleration_rate)) &amp;gt;&amp;gt;24;
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deceleration_time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acceleration_rate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Check step_rate stays positive
&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;final_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;acc_step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Decelerate from aceleration end point.
&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// lower limit
&lt;/span&gt;                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;final_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;final_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_FREQUENCY
&lt;/span&gt;           &lt;span class=&quot;c1&quot;&gt;// printf(&quot;current block nominal speed:%f\n&quot;, current_block-&amp;gt;nominal_speed);
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// step_rate to timer interval
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calc_timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isTwoWheelMotor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef OVERSAMPLED_DDA
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OVERSAMPLED_DDA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;TIM_SetAutoreload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIM2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#else
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;c1&quot;&gt;//for move
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//TIM_SetAutoreload(TIM2,temp);
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;deceleration_time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;//NOMINAL PHASE
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#ifdef JKN_ADVANCE
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_ACCEL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;advance_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ADVANCE_STATE_PLATEAU&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef OVERSAMPLED_DDA
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OCRnA_nominal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OVERSAMPLED_DDA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;TIM_SetAutoreload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TIM2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#else
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OCRnA_nominal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;c1&quot;&gt;//for move 
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//TIM_SetAutoreload(TIM2,temp);
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;step_loops&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;step_loops_nominal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;



        &lt;span class=&quot;c1&quot;&gt;// If current block is finished, reset pointer
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_events_completed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step_event_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef JKN_ADVANCE_LEAD_DE_PRIME
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXTRUDERS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;lastAdvanceDeprime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;advance_lead_deprime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_ROBOT
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;block finished&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;plan_discard_current_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;block_deleted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	    &lt;span class=&quot;c1&quot;&gt;//STEPPER_IOPORT_WRITE();
&lt;/span&gt;	    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isTwoWheelMotor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
		&lt;span class=&quot;c1&quot;&gt;//STEPPER_IOPORT_WRITE(stepperAxisPorts[X_AXIS].step,false);
&lt;/span&gt;		&lt;span class=&quot;c1&quot;&gt;//STEPPER_IOPORT_WRITE(stepperAxisPorts[Y_AXIS].step,false);
&lt;/span&gt;	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_ACCEL
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;one block finished&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Preprocess the setup for the next block if have have one
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plan_get_current_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;SET_IS_WORKING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;pStatus0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_STT
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;block poped %d %d %d %d %d rate = %dhz use_accel = %d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nominal_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;use_accel&lt;/span&gt;
		    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

	    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;block acc_until=%d dec_after=%d acc_rate = %d &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;accelerate_until&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decelerate_after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
		    &lt;span class=&quot;n&quot;&gt;current_block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acceleration_rate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;setup_next_block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;CLR_IS_WORKING&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	    &lt;span class=&quot;n&quot;&gt;pStatus0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef DEBUG_ACCEL
&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//			printf(&quot;target %u, finished %u\n\r&quot;,step_events_completed,current_block-&amp;gt;step_event_count);
&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;step_loops是做脉冲合并用的
最开始的一段程序，截止到calculate timer value 是用来进行脉冲反转的，后面的部分是根据速度和加速度来做timer中断时间设置的。&lt;/p&gt;

&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;if (step_events_completed &amp;lt;= (uint32_t)current_block-&amp;gt;accelerate_until) { // ACCELERATION PHASE&lt;/code&gt;这段代码之后是计算加速阶段该怎么运动的
这里
&lt;code class=&quot;highlighter-rouge&quot;&gt;acc_step_rate = (uint16_t)((float)acceleration_time*(float)(current_block-&amp;gt;acceleration_rate)/2000000.0f);&lt;/code&gt;
的意思是&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-math&quot;&gt;V_t = a\times t+V_0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;后面的减速部分也一样的
所以总的来看这个st_interrupt除了改变timer的间隔，和形成脉冲宽度没有别的bug了。
脉冲宽度的形成还是用busy_wait形成的。&lt;/p&gt;
</description>
        <pubDate>Sun, 29 Oct 2017 07:00:00 +0800</pubDate>
        <link>http://localhost:4000/2017/10/29/FDM_ACC/</link>
        <guid isPermaLink="true">http://localhost:4000/2017/10/29/FDM_ACC/</guid>
        
        <category>FDM</category>
        
        <category>3D打印</category>
        
        
        <category>FDM</category>
        
      </item>
    
  </channel>
</rss>
