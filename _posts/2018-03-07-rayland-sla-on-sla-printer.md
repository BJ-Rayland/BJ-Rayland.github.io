---
layout: post
title:  "用rayland-SLA主板控制SLA打印机"
date:   2018-03-07 16:00:00 +0800
categories: SLA 
tags:  3D打印  SLA
author: Gong Wei

---

* content
{:toc}

本文介绍`rayland-SLA`主板的接线以及`rayland-SLA`打印机软件的使用。




<img src="{{site.baseurl}}/images/sla_board.png"/>



## 基本参数

| 尺寸        | 115×93 mm    |
| --------- | ------------ |
| 重量        |              |
| 工作温度      | -20～65℃      |
| 主处理器主频    | 1.4GHz       |
| 主处理器类型    | 4核 Cortex A7 |
| 协处理器      | 72MHz        |
| 内存容量      | 1Gbytes      |
| Flash     | 4Gbytes      |
| 最大外接Flash | 32Gbytes     |


## 接线

<img src="/images/board_interface.png"/>
电源：电源接口供12V-24V电；
电机X：接控制浮块的电机；
电机Y：接控制刮刀的电机；
电机Z：接控制平台的电机；
XMIN,XMAX：分别接安装于X轴（浮块）上方和下方的碰撞开关；
YMIN,YMAX：分别接安装于Y轴（刮刀）前方和后方的碰撞开关；
ZMIN,ZMAX：分别接安装于Z轴（平台）上方和下方的碰撞开关；
振镜1：接振镜db25连接线；
激光器1GATA：接激光GATA口；
OUT1：接真空泵；
OUT2：接打印指示灯；
OUT3：接Z轴抱闸；

**注意事项：**
	振镜需要单独供正负15V电;
	液位仪默认支持松下HG-C1050，线序从上到下依次为屏蔽，灰，粉，黑，褐，蓝。如使用其他型号需要单独做适配;

## 软件使用

### 主页

​	主页主要包含一些常用操作及状态显示，具体如下图所示

<img src="{{site.baseurl}}/images/index.png" width="500"/>





点击坐下角的文件图标，弹出待打印文件界面，点击添加按钮可添加待打印文件，点击完成则关闭此界面，如下图所示；

<img src="{{site.baseurl}}/images/model_selector.png" width="500" />





点击添加按钮，弹出文件选择界面，选择需要打印的文件，文件的数据来源可以是SD卡或U盘的任意目录中的SLC文件，选择时可以选择多个文件，点击确定关闭此界面，如下图所示；

<img src="{{site.baseurl}}/images/select_models.png" width="500" />





选好文件后回到待打印界面，会自动显示之前选择的文件，并且会在主页自动加载待打印文件在当前层高的横切图。待打印界面还可点击文件左边的减号图标将文件从待打印目录中删除，拖动下方的进度条可以修改打印的起始层高，如下图所示。

<img src="{{site.baseurl}}/images/ready_print.png" width="500" />



选择好文件和起始层高后，点击首页的开始图标即可开始打印，开始打印后可以看到总高度发生变化，并且开始图标变成了暂停图标，如下图所示。

<img src="{{site.baseurl}}/images/is_printing.png" width="500" />



点击右下角的三点图标，可以打开更多菜单，其中包含5向操作，如下图所示：

<img src="{{site.baseurl}}/images/more_menu.png" width="500"/>



### 硬件控制


如下图，硬件控制界面主要用于手动控制设备和设备状态显示，有电机运动、碰撞开关状态、当前坐标、激光开关、真空泵开关、振镜运动；

<img src="{{site.baseurl}}/images/hardware_control.png" width="500"/>





点击各轴的坐标，可弹出对应轴的运动控制界面，如下图。

在此界面输入该轴坐标值，即可控制该轴运动到指定位置。

也可点击各轴左右两边的减号和加号图标，执行回最小处和最大处的运动；


<img src="{{site.baseurl}}/images/axis_control.png" width="500"/>



点击 激光标定 按钮，弹出激光标定界面，此功能用于调整激光扫描的准确度。如图所示，标定点横竖方向各11个，将事前做好的标定板放在平台上，如果此时激光在标定板上的位置 和 软件界面中的位置不符，则控制软件中的上下左右四个方向键移动光斑，每次移动的距离可在编辑栏中修改，当光斑在标定板上的位置和软件界面中位置一致时，点击 下一个 将光斑移动到下一个标定点 ，继续观察位置是否一致，如不一致再和之前一样修改，以此类推将所有标定点都过一次即可完成标定操作；

<img src="{{site.baseurl}}/images/laser_calibration.png" width="500"/>

### 参数设置

<img src="{{site.baseurl}}/images/paramer_setting.png" width="500"/>

#### 硬件设置
##### 刮刀

###### 刮刀打印时速度

​	设置刮刀在打印模型时的运动速度，单位mm/s；

###### 刮刀控制时速度

​	设置刮刀在手动控制时的运动速度，如在硬件控制界面控制刮刀运动时的速度，单位mm/s；

##### 平台
###### 平台打印时速度
​	设置平台在打印模型时的运动速度，单位mm/s；
###### 平台控制时速度
​	设置平台在手动控制时的运动速度，如在硬件控制界面控制平台运动时的速度，单位mm/s；
###### 距液面高度
​	设置平台在打印时的起始位置，指平台从最高点下降到起始位置所需的距离，单位mm；

##### 浮块
###### 浮块打印时速度
​	设置浮块在打印模型时的运动速度，单位mm/s；
###### 浮块控制时速度
​	设置浮块在手动控制时的运动速度，如在硬件控制界面控制浮块运动时的速度，单位mm/s；

##### 激光
###### 激光极性
​	设置激光的开关极性，即激光打开时电压高还是低，分为高有效和低有效两种；
###### 光路长度
​	设置振镜距离平台起始位置的距离值，该值影响到打印时扫描速度的准确性，单位mm；

#### 制作设置
##### 刮刀
###### 起刮高度
​	设置刮刀的运动条件，当层高大于等于该值且扫描路径包含模型实体部分时，刮刀开始运动，单位mm(若层高大于等于该值，但当前层高仍只是打印支撑部分，则刮刀不运动)；

###### 刮平次数
​	设置刮刀开始运动后，每层的刮平次数；
##### 激光
###### 激光开延时
​	设置激光在打开时的延迟值，单位us(所有激光在打开和关闭时的均有一定的延迟，不同品牌的激光延迟值可能不一样);
###### 激光关延时
​	设置激光在关闭时的延迟值，单位us(所有激光在打开和关闭时的均有一定的延迟，不同品牌的激光延迟值可能不一样);
##### 等待时间
###### 流平时间
​	设置每一层电机运动完后，开始扫描前的等待时间，单位s;
###### 固化时间
​	设置每一层扫描完后，电机运动前的等待时间，单位s;
###### 浸泡时间
​	设置模型打印完后，平台上升前的等待时间，单位s;
#### 液位设置
##### 目标高度
​	设置打印时的理想液位高度，打印时自动维持这个高度，单位mm;
##### 当前高度
​	当前反馈的液位高度，用于参考，自动显示，无需设置，单位mm;
##### 允许偏差
​	设置在自动维持目标液位高度时，允许的误差值，单位mm;
##### 最大高度
​	设置液位仪支持的最大高度值，单位mm;
##### 最小高度
​	设置液位仪支持的最小高度值，单位mm;
#### 扫描设置
##### 扫描间距
​	设置扫描填充部分时的扫描间距，和光斑大小一样最为合适，单位mm;
##### 坐标轴
###### X比例
​	设置打印时X轴模型缩放比例;
###### Y比例
​	设置打印时Y轴模型缩放比例;
###### XY方向
​	设置扫描时XY轴的方向，由于激光和振镜的安装方位不同，可能会出现XY轴方向混乱的问题，改设置共有8种选项，分别为：XY不反向、X反向、Y反向、XY反向、XY对调、XY对调，X反向、XY对调，Y反向、XY对调，XY反向;
##### 扫描速度
###### 支撑扫描速度
​	设置打印模型支撑部分时的激光扫描速度;
###### 轮廓扫描速度
​	设置打印模型轮廓部分时的激光扫描速度;
###### 填充扫描速度
​	设置打印模型填充部分时的激光扫描速度;
###### 空走扫描速度
​	设置激光空走(即不开激光移动)时的速度;

#### 机器设置
##### (浮块)X轴，(刮刀)Y轴，(平台)Z轴设置
###### 驱动电压
​	设置当前轴的电机驱动电压，只对使用4988驱动模块的场景下生效，可套用公式   
				127 x 电机标准电流 / 2
计算，使用外置驱动时无需设置;
###### 最大脉冲频率
​	设置该轴的电机运动时的最大脉冲频率，用于限制电机最大速度；
###### 归零脉冲频率
​	设置该轴电机做复位运动时的默认脉冲频率；
###### 每毫米步进数
​	设置该轴每运动1mm电机所需的步进数，可套用公式
				细分数 x 200 / 丝杆间距(或传动轮周长)；
###### 轴长
​	设置该轴的长度，单位mm；
###### 碰撞开关安装位置
​	设置该轴的碰撞开关安装的位置，选项有“安装在最小”，“安装在最大”，“均安装“三种；
###### 碰撞开关极性
​	设置该轴碰撞开关的极性，即平常状态下和触发状态下电压的高低，选项有”常低碰高“，”常高碰低“两种；
###### 是否反向
​	设置该轴运动方向是否相反；
### 软件更新

本软件更新方式为离线更新，在产品交流群中可获取最新软件包，将软件包拷贝到U盘后插上主板USB接口，软件将自动检测更新包，并弹出更新提示，电机安装即可自动更新。

<img src="{{site.baseurl}}/images/version_update.png" width="500"/>


## 打印前的检测
### 碰撞开关检测

​	打开软件的 硬件控制 界面，分别触发浮块、刮刀、平台的两个碰撞开关，触发时观察界面上对应轴两侧的碰撞开关显示状态，正常情况下未触发时为灰色，触发时为绿色。如果颜色相反说明碰撞开关极性设置不对，可去 参数设置--机器设置--对应轴设置--碰撞开关极性 处修改极性；

​	<img src="{{site.baseurl}}/images/check_endstop.png" width="500"/>

### 电机运动检测



​	1. 打开软件的 硬件控制 界面，分别触发浮块，刮刀，平台往最大和最小方向处复位的操作，浮块和平台最大方向为上方，最小方向为下方，刮刀最大方向为后方，最小方向为前方，看电机是否正常运动，点击两侧的 加号 和减号 图标即可发送 最大和最小方向的复位命令。

​	如果电机运动方向相反，可在软件中 参数设置--机器设置--对应轴设置--是否反向 处修改，也可直接修改电机接线改变方向；

​	2. 分别控制浮块，刮刀，平台移动指定距离，看实际移动的距离是否一致。电机对应轴的坐标值即可弹出控制界面，输入坐标值，电机确定即可开始运动；

​	如果电机运动距离与实际不符，说明该电机的每毫米步进数设置错误，可在软件中去 参数设置--机器设置--对应轴设置--每毫米步进数 处修改，该值的设定可套用公式  细分数 x 200 / 丝杆间距(或传动轮周长)；

​	<img src="{{site.baseurl}}/images/check_sport.png" width="500"/>



### 激光开关检测

​	打开软件的 硬件控制 界面，点击如下图所示的开关按钮，观察激光是否能开关，正常情况下点击关闭图标后激光处于关闭状态，点击打开图标后激光处于打开状态，如果相反则说明激光极性设置错误，可以在软件的 

参数设置--激光极性 处修改；

​	<img src="{{site.baseurl}}/images/check_laser.png" width="500"/>

### 振镜运动检测
#### 运动方向检测

​	打开软件的 硬件控制 界面，点击如下图所示的激光标定按钮；

<img src="{{site.baseurl}}/images/start_calibrating.png" width="500"/>

​	弹出激光标定界面，分别选择上下左右四个方向的标定点，观察激光是否也是向这四个方向移动，如果激光点一直不移动则检查振镜接线和供电，如果移动方向不对可参考  XY方向 设置项 设置XY方向；

<img src="{{site.baseurl}}/images/check_scan_direction.png" width="500"/>

#### 扫描测试

​	打开软件首页，点击下图所示按钮，振镜开始以每次间隔1秒的时间扫描一个三角形，再次点击按钮则停止扫描。

<img src="{{site.baseurl}}/images/scan_test.png" width="500"/>

### 液位仪数据检测

​	打开软件首页，可用一张纸放到液位仪下方上下移动，观察软件上液位值变化，如下图所示。

如移动时数值不变化则检查液位仪接线是否正确。

<img src="{{site.baseurl}}/images/check_liquid_height.png" width="500"/>

### 真空泵开关检测

​	打开软件 硬件控制 界面，如下图所示，点击真空泵开关按钮，观察真空泵是否能开关。

​	<img src="{{site.baseurl}}/images/check_pump.png" width="500"/>


## 常见问题

**1. 电机运动距离与命令不符**

	检查该电机的每毫米步进数设置是否错误，在 参数设置--机器设置--对应轴(X为浮块，Y为刮刀，Z为平台)设置--每毫米步进数 处修改，该值可套用公式设置：

			细分数 x 200 / 丝杆间距(或传动轮周长)；

**2. 电机只能往一个方向运动**

	检查该轴的"碰撞开关安装位置"和"碰撞开关极性"这两个设置，在 参数设置--机器设置--对应轴(X为浮块，Y为刮刀，Z为平台)设置 下。这种情况一般是由于"碰撞开关安装位置"设为"安装在最大"或"安装在最小"，且碰撞开关极性设置错误导致的。只需将"碰撞开关极性"设对就没问题了，"碰撞开关安装位置"建议设为"均安装";	

**3. 激光的打开和关闭操作相反**	

	一般是"激光极性"没有设置对，在 参数设置--硬件设置--激光极性 处修改，选择另一种设置项即可;

**4. 激光扫描速度与设置不符**	

	一般是"光路长度"没有设置对，在 参数设置--硬件设置--光路长度 处修改，该值取振镜到平台打印位置的距离即可，单位mm;

**5. 激光扫描方向错乱**	

	由于激光和振镜的安装方位不同，可能会出现XY轴方向混乱的问题，可以在 参数设置--扫描设置--XY方向 处修改"XY方向"设置，判别方式可以通过在 硬件控制--激光标定 处打开标定界面，先点击中心处的标定点将激光光斑移到平台中心，然后分别点击上下左右的标定点，看激光是否向对应方向移动。如：点击上方标定点发现光斑实际向下移动，点击下方标定点光斑实际向上运动，则表明Y轴反向；点击左方标定点发现光斑实际向右移动，点击右方标定点光斑实际向左运动，则表明X轴反向；点击上方标定点发现光斑实际向右移动，点击下方标定点光斑实际向左运动，则表明XY轴对调；点击上方标定点发现光斑实际向左移动，点击下方标定点光斑实际向右运动，则表明XY轴对调且XY反向；	

**6. 打印时模型无法固定在平台上，或模型被刮刀刮离平台**	

	一般出现这种情况有3个可能的原因：
		平台打印起始位置设置不合适，可在 参数设置--硬件设置--距液面高度 设置；
		目标液值位设置不合适，可在 参数设置--液位设置--目标高度 设置；
		平台不平整，没有调平，可通过调节平台上的螺丝旋钮调节；
	打印时，树脂液位应和平台、刮刀相持平为最佳。



## 附FPGA烧录方法

 1.  工具准备：

     ​	USB-Blaster

     ​	Mini-Usb数据线

     ​	烧录软件Quartus II

     ​<img src="{{site.baseurl}}/images/fpga_write_tools.jpg" width="500"/>



2. 给SLA主板供12V电，主板CPLD-JTAG口接USB-Blaster，如下图所示

   ​	<img src="{{site.baseurl}}/images/usb_blaster_in_board.jpg" width="500"/>

   ​

   3. 在PC端打开Quartus软件，按CTRL+J打开要烧录的工程目录，选择.qpf文件，如下图所示

      <img src="{{site.baseurl}}/images/open_fpga_project.png" width="500"/>

   4. 如下图所示，双击 Program Device选项，打开烧录对话框，选择USB-Blaster [USB-0]

      ​		<img src="{{site.baseurl}}/images/open_programmer.png" width="500"/>



5. 点击 start 按钮，开始烧录，烧录成功则progress显示100%，重启主板即可生效。如下图所示，

<img src="{{site.baseurl}}/images/writing.png" width="500"/>



<img src="{{site.baseurl}}/images/write_success.png" width="500"/>